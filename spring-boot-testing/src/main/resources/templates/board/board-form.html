<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
>
<body>


<div class="content-wrapper" layout:fragment="content-body">
    <h1>게시판 생성 페이지</h1>
    <form method="post" th:object="${form}" enctype="multipart/form-data">
        <div th:replace="~{fragment/elements :: frag_input('제목', 'title', 20)}"></div>
        <span>내용 :</span><textarea th:field="*{content}"></textarea>
        <span>파일 : </span><input type="file" name="file">
        <div class="error" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">내용 에러</div>
        <br>
        <input type="submit">
        <button id="btn-submit-json" type="button">JSON으로 등록</button>
    </form>
</div>

<script layout:fragment="script-body">
async function submit() {
	  const req = {'title': document.getElementsByName("title")[0].value, 'content': document.getElementsByName("content")[0].value};
      let response = await fetch('/board/form/rest', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(req)
      });
      let result = await response;
      if(result.status === 200){
      	location.href= "/board/page";
      }else if(result.status === 428){
      	alert("요청 값이 올바르지 않습니다");
      }else{
      	alert("알 수 없는 문제가 발생하였습니다");
      }
    }

document.getElementById("btn-submit-json").addEventListener("click", submit);

</script>


</body>
</html>